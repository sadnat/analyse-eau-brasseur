<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse d'eau pour le brassage de la bière</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">

    <!-- Styles -->
    <!-- AVERTISSEMENT SECURITE : cdn.tailwindcss.com est le mode "Play" de Tailwind, destiné au prototypage uniquement.
         En production, il est fortement recommandé de compiler Tailwind CSS (npx tailwindcss build)
         et de servir un fichier CSS statique. Le CDN Play ne supporte pas SRI car il génère du contenu dynamiquement. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            800: '#1e293b',
                            900: '#0f172a',
                        },
                        sky: {
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                        }
                    },
                    animation: {
                        'fade-in-down': 'fadeInDown 0.8s ease-out',
                        'fade-in-up': 'fadeInUp 0.8s ease-out',
                        'pulse-slow': 'pulse 3s infinite',
                    },
                    keyframes: {
                        fadeInDown: {
                            '0%': { opacity: '0', transform: 'translateY(-20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha384-3B6NwesSXE7YJlcLI9RpRqGf2p/EgVH8BgoKTaUrmKNDkHPStTQ3EyoYjCGXaOTS" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            /* Palette Premium "Deep Ocean" */
            --color-darkest: #0f172a;
            /* Slate 900 */
            --color-dark: #1e293b;
            /* Slate 800 */
            --color-primary: #0ea5e9;
            /* Sky 500 */
            --color-secondary: #38bdf8;
            /* Sky 400 */
            --color-accent: #f59e0b;
            /* Amber 500 */
            --color-text-light: #f1f5f9;
            /* Slate 100 */
            --color-text-dim: #94a3b8;
            /* Slate 400 */

            --glass-bg: rgba(15, 23, 42, 0.6);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--color-text-light);
        }

        .gradient-background {
            background: radial-gradient(circle at top left, #1e293b, #0f172a);
            min-height: 100vh;
            position: relative;
        }

        .gradient-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 15% 50%, rgba(14, 165, 233, 0.15), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(56, 189, 248, 0.15), transparent 25%);
            pointer-events: none;
            z-index: 0;
        }

        .glass-effect {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        .input-focus {
            transition: all 0.3s ease;
            border-color: var(--color-primary);
        }

        .input-focus:focus {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(10, 147, 150, 0.2);
            border-color: var(--color-primary);
        }

        .card-hover {
            transition: all 0.3s ease;
            border: 1px solid var(--color-secondary);
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 18, 25, 0.1);
            border-color: var(--color-primary);
        }

        .version-badge {
            background: rgba(14, 165, 233, 0.2);
            color: var(--color-primary);
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            border: 1px solid rgba(14, 165, 233, 0.3);
            transition: all 0.3s ease;
        }

        .version-badge:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .version-icon {
            margin-right: 0.375rem;
            font-size: 0.75rem;
            animation: pulse-light 2s infinite ease-in-out;
        }

        @keyframes pulse-light {

            0%,
            100% {
                opacity: 0.8;
            }

            50% {
                opacity: 1;
            }
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-dark) 100%);
            color: white;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--color-dark) 0%, var(--color-darkest) 100%);
            transform: translateY(-2px);
        }

        .chemical-formula {
            color: var(--color-warning);
            font-weight: 500;
        }

        .result-card {
            border-left: 4px solid var(--color-primary);
        }

        .title-glow {
            text-shadow: 0 0 20px rgba(14, 165, 233, 0.5);
            color: var(--color-text-light);
            font-weight: 800;
            letter-spacing: -0.025em;
        }

        .subtitle-glow {
            color: var(--color-secondary);
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .calculator-button {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            color: white;
            font-weight: 600;
            padding: 1rem 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(14, 165, 233, 0.4);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .calculator-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 30px -10px rgba(14, 165, 233, 0.5);
            background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-primary) 100%);
        }

        .logo-container {
            position: relative;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .logo-text {
            font-family: 'Inter', sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            color: var(--color-text-light);
            margin: 0;
            line-height: 1.1;
            display: flex;
            flex-direction: column;
            align-items: center;
            letter-spacing: -0.05em;
        }

        .logo-text span {
            display: block;
        }

        .logo-text .highlight {
            background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-primary) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 0.8em;
            filter: drop-shadow(0 0 20px rgba(14, 165, 233, 0.3));
        }

        .logo-icon {
            font-size: 2.5rem;
            color: var(--color-primary);
            margin: 0 0.5rem;
            vertical-align: middle;
            filter: drop-shadow(0 0 15px rgba(14, 165, 233, 0.5));
        }

        .logo-divider {
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
            margin: 2rem auto;
            border-radius: 2px;
            opacity: 0.5;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        @keyframes gradientSpin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loading-pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        .gradient-spinner {
            background: conic-gradient(from 0deg,
                    #0a9396,
                    #94d2bd,
                    #e9d8a6,
                    #ee9b00,
                    #0a9396);
        }
    </style>
</head>

<body class="gradient-background min-h-screen text-gray-200 selection:bg-sky-500 selection:text-white">
    <div class="absolute top-6 left-6 version-badge">
        <i class="fas fa-code-branch version-icon"></i>
        <span>v1.0.0</span>
    </div>

    <div class="container mx-auto px-4 py-12 max-w-6xl">
        <div class="logo-container animate-fade-in-down">
            <div class="flex items-center justify-center mb-6">
                <div class="p-4 rounded-2xl glass-effect">
                    <i class="fas fa-water logo-icon"></i>
                </div>
            </div>
            <h1 class="logo-text">
                <span class="text-3xl font-light tracking-widest uppercase text-slate-400 mb-2">Analyse d'eau</span>
                <span class="highlight">POUR BRASSEUR</span>
            </h1>
            <div class="logo-divider"></div>
        </div>

        <!-- Filtres -->
        <div class="mb-12 relative z-10">
            <form id="searchForm"
                class="glass-effect rounded-2xl p-8 transform transition-all hover:scale-[1.01] duration-500">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-3">
                        <label for="departementSelect"
                            class="block text-sm font-semibold text-slate-400 uppercase tracking-wide">Département</label>
                        <div class="relative">
                            <select id="departementSelect"
                                class="w-full bg-slate-800/50 border border-slate-700/50 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all appearance-none cursor-pointer hover:bg-slate-800/70">
                                <option value="">Sélectionnez un département...</option>
                            </select>
                            <div
                                class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none text-slate-400">
                                <i class="fas fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <label for="communeSelect"
                            class="block text-sm font-semibold text-slate-400 uppercase tracking-wide">Commune</label>
                        <div class="relative">
                            <select id="communeSelect"
                                class="w-full bg-slate-800/50 border border-slate-700/50 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all appearance-none cursor-pointer hover:bg-slate-800/70 disabled:opacity-50 disabled:cursor-not-allowed"
                                disabled>
                                <option value="">Sélectionnez une commune...</option>
                            </select>
                            <div
                                class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none text-slate-400">
                                <i class="fas fa-chevron-down text-xs"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Indicateur de chargement -->
        <div id="loading" class="hidden">
            <div class="flex items-center justify-center p-12">
                <div
                    class="glass-effect flex flex-col items-center gap-6 rounded-3xl px-12 py-8 shadow-2xl bg-slate-900/50">
                    <div class="relative flex items-center justify-center">
                        <div
                            class="absolute w-16 h-16 rounded-full border-4 border-sky-500/30 border-t-sky-500 animate-spin">
                        </div>
                        <div class="w-16 h-16 flex items-center justify-center">
                            <i class="fas fa-beer text-2xl text-amber-500 animate-pulse"></i>
                        </div>
                    </div>
                    <span class="text-lg font-medium text-sky-400 tracking-widest uppercase animate-pulse">Analyse en
                        cours...</span>
                </div>
            </div>
        </div>

        <!-- Message d'erreur -->
        <div id="error" class="hidden p-4 bg-red-50 text-red-700 rounded-xl mb-4 border border-red-100 shadow-sm"></div>

        <!-- Sélection des réseaux -->
        <div id="networkButtons" class="hidden animate-fade-in-up">
            <h2 class="text-2xl subtitle-glow mb-6 flex items-center gap-3">
                <i class="fas fa-network-wired text-sky-500"></i>
                Réseaux disponibles
            </h2>
            <div class="flex flex-wrap gap-4">
            </div>
        </div>

        <!-- Paramètres actuels -->
        <div id="currentParameters" class="hidden glass-effect rounded-2xl p-8 my-12 shadow-2xl animate-fade-in-up">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl subtitle-glow flex items-center gap-3">
                    <i class="fas fa-flask text-sky-500"></i>
                    Dernières valeurs mesurées
                </h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>

            <div class="mt-10 flex justify-center">
                <button id="openCalculator" class="calculator-button group relative overflow-hidden">
                    <span class="relative z-10 flex items-center gap-2">
                        <i class="fas fa-calculator"></i>
                        Ouvrir le Calculateur de Minéraux
                    </span>
                    <div
                        class="absolute inset-0 bg-gradient-to-r from-amber-500 to-orange-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    </div>
                </button>
            </div>
        </div>

        <!-- Module Calculateur -->
        <div id="waterCalculator" class="hidden glass-effect rounded-2xl p-8 my-12 shadow-2xl animate-fade-in-up">
            <h2 class="text-2xl subtitle-glow mb-8 flex items-center gap-3">
                <i class="fas fa-calculator text-amber-500"></i>
                Calculateur de Minéraux
            </h2>

            <!-- Quantité d'eau -->
            <div class="mb-8 p-6 bg-slate-800/30 rounded-xl border border-slate-700/30">
                <label class="block text-sm font-semibold text-slate-400 mb-3 uppercase tracking-wide">Quantité d'eau
                    (litres)</label>
                <div class="relative">
                    <input type="number" id="waterQuantity"
                        class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all font-mono text-lg"
                        value="20" min="1">
                    <i class="fas fa-tint absolute right-4 top-1/2 transform -translate-y-1/2 text-sky-500"></i>
                </div>
            </div>

            <!-- Ajout de minéraux -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Sulfate de calcium <span
                                class="text-xs text-amber-500 font-mono ml-2">CaSO₄·2H₂O</span></label>
                        <div class="relative group">
                            <input type="number" id="calciumSulfate"
                                class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 pr-12 text-white focus:outline-none focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all"
                                value="0" min="0" step="0.1">
                            <span
                                class="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium group-focus-within:text-sky-500 transition-colors">g</span>
                        </div>
                    </div>
                </div>
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Sulfate de magnésium <span
                                class="text-xs text-amber-500 font-mono ml-2">MgSO₄·7H₂O</span></label>
                        <div class="relative group">
                            <input type="number" id="magnesiumSulfate"
                                class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 pr-12 text-white focus:outline-none focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all"
                                value="0" min="0" step="0.1">
                            <span
                                class="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium group-focus-within:text-sky-500 transition-colors">g</span>
                        </div>
                    </div>
                </div>
                <!-- ... other inputs ... will be auto-filled by user but for now keeping structural changes minimal to avoid huge replacement blocks, just defining the pattern -->
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Chlorure de calcium <span
                            class="text-xs text-amber-500 font-mono ml-2">CaCl₂·2H₂O</span></label>
                    <div class="relative group">
                        <input type="number" id="calciumChloride"
                            class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 pr-12 text-white focus:outline-none focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all"
                            value="0" min="0" step="0.1">
                        <span
                            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium group-focus-within:text-sky-500 transition-colors">g</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Chlorure de sodium <span
                            class="text-xs text-amber-500 font-mono ml-2">NaCl</span></label>
                    <div class="relative group">
                        <input type="number" id="sodiumChloride"
                            class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 pr-12 text-white focus:outline-none focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all"
                            value="0" min="0" step="0.1">
                        <span
                            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium group-focus-within:text-sky-500 transition-colors">g</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Carbonate de calcium <span
                            class="text-xs text-amber-500 font-mono ml-2">CaCO₃</span></label>
                    <div class="relative group">
                        <input type="number" id="calciumCarbonate"
                            class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 pr-12 text-white focus:outline-none focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all"
                            value="0" min="0" step="0.1">
                        <span
                            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium group-focus-within:text-sky-500 transition-colors">g</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Bicarbonate de sodium <span
                            class="text-xs text-amber-500 font-mono ml-2">NaHCO₃</span></label>
                    <div class="relative group">
                        <input type="number" id="sodiumBicarbonate"
                            class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 pr-12 text-white focus:outline-none focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all"
                            value="0" min="0" step="0.1">
                        <span
                            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium group-focus-within:text-sky-500 transition-colors">g</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-300 mb-2">Chlorure de potassium <span
                            class="text-xs text-amber-500 font-mono ml-2">KCl</span></label>
                    <div class="relative group">
                        <input type="number" id="potassiumChloride"
                            class="w-full bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 pr-12 text-white focus:outline-none focus:ring-2 focus:ring-sky-500/50 focus:border-sky-500 transition-all"
                            value="0" min="0" step="0.1">
                        <span
                            class="absolute right-4 top-1/2 transform -translate-y-1/2 text-slate-500 font-medium group-focus-within:text-sky-500 transition-colors">g</span>
                    </div>
                </div>
            </div>

            <!-- Résultats -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Eau de base -->
                <div class="p-6 bg-slate-800/40 rounded-2xl border border-slate-700/50">
                    <h3 class="text-lg font-bold text-slate-300 mb-4 flex items-center gap-2">
                        <i class="fas fa-tint text-sky-500"></i> Eau de base
                    </h3>
                    <div id="baseWaterParams" class="space-y-3"></div>
                </div>
                <!-- Eau après ajouts -->
                <div class="p-6 bg-slate-800/40 rounded-2xl border border-slate-700/50 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10">
                        <i class="fas fa-flask text-6xl"></i>
                    </div>
                    <h3 class="text-lg font-bold text-slate-300 mb-4 flex items-center gap-2">
                        <i class="fas fa-magic text-amber-500"></i> Eau modifiée
                    </h3>
                    <div id="modifiedWaterParams" class="space-y-3"></div>
                </div>
            </div>
        </div>

        <!-- Graphiques -->
        <div id="charts" class="hidden space-y-8 pb-12">
            <h2 class="text-2xl font-bold text-slate-200 mb-6 flex items-center gap-3">
                <i class="fas fa-chart-line text-sky-500"></i>
                Historique des mesures
            </h2>
            <div id="chartsGrid" class="grid grid-cols-1 lg:grid-cols-2 gap-8"></div>
        </div>

        <!-- Debug -->


        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js" integrity="sha384-8IfMRI2dZTiLP9YEdmV1crHEnWdDyLYVokg18OO8HivLDMuK1rbsaFRSQl7rgQ0D" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js" integrity="sha384-4mFQWIqZrcfYZkFPEgIoT//zTEU64gEoH2tGV72Koyhoa9Fxz43YgroFUGj4/RAx" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js" integrity="sha384-7cWzHabR6ZyfMWzZgVssYaOQRTccHUWZ0F09AanlF3RAJ/JNyFnIma2JTYIVKEUP" crossorigin="anonymous"></script>
        <script>
            // Gestionnaire d'erreur global - ne pas exposer de détails en production
            window.onerror = function (msg, url, lineNo, columnNo, error) {
                console.error('Application error occurred');
                return false;
            };
        </script>
        <script src="app.js" defer></script>
</body>

</html>